<%= render :partial => 'sub_menu' -%>

<% form_tag user_month_review_path(@user, :id => :calendar), :method => :get do %>
  <p>
    <label for="date">Period</label>
    <%= date_select "calendar", "date", {:start_year => Date.today.year - 5 , :end_year => Date.today.year + 1, :discard_day => true, :default => @period.start} %>
    <%= submit_tag 'View' %>
  </p>
<% end %>

<hr/>
<br/>
<table>
<tr>
	<td></td>
	<th>Mon</th>
	<th>Tue</th>
	<th>Wed</th>
	<th>Thu</th>
	<th>Fri</th>
	<th class="error">Sat</th>
	<th class="error">Sun</th>
</tr>
<% @period.start.beginning_of_week.upto(@period.end.end_of_week) do |d| %>
	<% if d.wday == 1 %>
		<tr>
		<th><%= link_to d.cweek.to_s, user_time_entries_path(:user_id => @user, :date => d) %></th>
	<% end %>
	<td <%= 'style="color: #eeeeee;"' if d.month != @period.start.month %>><%= @user.hours_on_day d -%></td>
	<% if d.wday == 0 %>
		</tr>
	<% end -%>
<% end %>
</table>
<br />
<table>
	<% @activities_summary.each do |entry| %>
		<tr>
			<td><%= entry[:name] -%></td>
			<td><%= entry[:hours] -%></td>
			</tr>
	<% end %>
	<tr>
		<td>Total:</td>
		<td> <%= @period.total_hours -%></td>
	</tr>
</table>

<% if @period.locked? -%>
	<p>
		<b>You have submitted this month.</b>
	</p>
<% elsif @period.ready_for_approval? -%>
   <p>
		<% form_tag lock_user_time_entries_path(@user) do -%>
			<%= hidden_field_tag "user_id", @user.id %>
			<%= hidden_field_tag "start_date", @period.start %>
			<%= hidden_field_tag "end_date", @period.end %>
			<%= submit_tag "Submit for billing"%>
		<% end -%> 
	</p>
	<br/>
<% else -%>
	<p>
		<b><%= "You have not registered enough hours this month. Expected #{@period.expected_hours}, but was #{@period.total_hours}." %></b>		
	</p>
<% end -%>