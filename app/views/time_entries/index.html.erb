<h1>Entries for week <%= @date.cweek %> (<%= User.find(params[:user_id]).fullname %>)</h1>
<p class="notice"><%= flash[:notice] %></p>
<p class="error"><%= flash[:error] %></p>
<span>
	<%= link_to "Previous week", user_time_entries_path(:user_id => params[:user_id], :date => @date.beginning_of_week.-(7)) %>
	|
	<%= link_to "Next week", user_time_entries_path(:user_id => params[:user_id], :date => @date.beginning_of_week.+(7)) %>
	|
	<% form_tag user_time_entries_path(@user), :method => :get, :class => "inline_form" do -%>
		<%= select_date @date, :order => [:day, :month, :year] %>
		<%= submit_tag "View" %>
	<% end -%>
</span>
<br /><br />
<hr />
<p>
	<% 7.times do |index| %>
		<% day = TimeEntriesController::WEEKDAYS[index] %>
		<div id="<%= day %>">
			<p>
				<div id='<%= "#{day}_header" %>'>
					<b><%= "#{day} (#{@date.+(index)})" %></b>
					<label id='<%= "#{day}_total_label" %>' for='<%= "#{day}_total" %>'>Total</label>  
					<span id='<%= "#{day}_total" %>'>
						<b><%= TimeEntry.sum_hours_for_user_and_date(@user.id, @date.+(index)) %></b>
					 </span>
					<%= link_to_remote("New", { :url => { :action => :new, :user_id => @user.id, :date => @date.+(index), :day => day }, :method => :get }, 
					:href => new_user_time_entry_path(@user, :date => @date.+(index)), :id => "#{day}_new_time_entry_link" ,  :class => "new_time_entry_link") %> 
				</div>
			    <br />
			<div id='<%= "#{day}_time_entry_form"%>'></div>
			<div id='<%= "#{day}_time_entries_container"%>'>
 				<%= render :partial => "time_entries", :locals => { :time_entries => TimeEntry.find_all_by_user_id_and_date(@user.id, @date.+(index)), :day => day } %>
			</div>
			</p>
		</div>
	<% end -%>
</p>
<hr />
<p>
	<% if @current_user.admin -%>
		<% form_tag "/time_entries/change_user" do %>
			<%= hidden_field_tag :user_id, @user.id %>
			<%= hidden_field_tag :date, @date %>
			<%= select_tag "new_user_id", options_from_collection_for_select(User.all, :id, :fullname) %>
			<%= submit_tag "View for selected user" %>
		<% end -%>
	<% end -%>
</p>