
<h1>User Report</h1>

<%= render :partial => 'sub_menu' -%>

<p class="error"><%= flash[:error] %></p>
<p class="notice"><%= flash[:notice] %></p>


  <%= will_paginate @users %>

  <table class="regular">
    <tr>
      <th></th>
      <% @weeks.each do |date| %>
      <th>Week <%= date.cweek %> </th>
      <% end %>
    </tr>

    <tr class="grayed">
      <td class="underline overline">Normal working hours</td>
      <% @expected.each do |hours| %>
      <td class="underline overline"><%= hours %> </td>
      <% end %>
    </tr>

    <tr><td colspan="99"></td></tr>

    <% @users.each do |user| %>
      <tr>
        <td><%=h user.name %> </td>
        <% @weeks.each_with_index do |date, index| %>
          <% hours = TimeEntry.for_user(user).between(date, (date + 6)).sum(:hours) %>
          <% color_code = case hours
              when 0 : "grayed"
              when 0..(@expected[index] -1): ""
              when (@expected[index])..(@expected[index] * 1.3): "ok"
              else "error"
          end %>

            <td class="<%= color_code -%>"><%= hours %></td>

        <% end %>
      </tr>
    <% end %>

    <tr>
      <th class="overline">Total</th>
      <% @totals.each do |total| %>
      <th class="overline"><%= total %></th>
      <% end %>
    </tr>
    
  </table>

  <%= will_paginate @users %>
  <br/>

<%#= render :partial => 'download', :locals => { :params => params, :action => 'user' } -%>


